<!DOCTYPE html>
<html>
  <head>

    {% import 'elements.html.j2' as elements %}
    {{ elements.head(template_params) }}
    {{ elements.init_elements() }}
    {{ elements.standard_background() }}

  </head>

  <body>

    <script>
      function lang_toggle() {
        if (document.getElementById("lang_menu").style.visibility == "hidden") {
          document.getElementById("lang_menu").style.visibility = "visible";
          document.getElementById("lang_roll_off").style.display = "none";
          document.getElementById("lang_roll_on").style.display = "inline";
        } else {
          document.getElementById("lang_menu").style.visibility = "hidden";
          document.getElementById("lang_roll_off").style.display = "inline";
          document.getElementById("lang_roll_on").style.display = "none";
        }
      }
    </script>
    <div width="100%" style='display:block; text-align: right;'> 
        <button style="display: inline-block; height: 24pt; 
                cursor:pointer; text-decoration:none; background-color:rgba(0, 0, 0, 0);
                outline:none;border:none;
                vertical-align: middle; text-align: right; 
                margin-top: 11px; margin-right: 30px;" 
                onclick="lang_toggle()"> {{template_params["current_lang"]}}
          <img id="lang_roll_off" src="item?url=images/arrow_down_closed.svg" 
                style="display:inline; width: 20px; height: 14px;"> 
          <img id="lang_roll_on" src="item?url=images/arrow_down_open.svg" 
                style="display:none; width: 20px; height: 14px;">                
        </button>
    </div>
    <div id="lang_menu" style="visibility: hidden; position:fixed; z-index: 2; top: 35px; right: 30px;
          background-color:#029194; color: white">
          {% for lang in template_params["menu_lang"] %}    
            <a href="{{ lang['link'] }}" style="text-decoration:none">      
              <div style="display: inline-block; padding: 8px 8px 8px 8px; 
                          font-family: 'Lato-Regular'; font-size: 18px; color: #f7f7f7">  
                {{lang["name"]}}
              </div> 
            </a> <br>
          {% endfor %}
    </div>


    <div align="center" style="display:content; margin-top:15px;">
      <img src='item?url=images/home_page_img.svg' width='360'>
    </div>
    <div align="center" class="sh_chalk_bold_font" style="display:content; margin-top:36px; font-weight: 400; font-size: 55px; color: #029194">
    TATA MATA
    </div>
    <div align="center" class="sh_lato_font" style="display:content; margin-top:0px; font-size: 18px; color: #dc3d39">
      Vežbaonica matematike <br>
      za osnovnu školu
    </div>



    <!-- START WAIT POPUP -->
    {{elements.start_popup("wait", "top: 127px; left: 0%; 
         width: 100%; text-align: center; background: white; scroll-y: auto;
         border-radius: 10px; border: 0px solid #000000; box-shadow: 0px 5px 5px #dddddd;", 
         "100%", "0px", False)}}

      {% set width=4 %}

      <div style="display:block; width: 100%; text-align: center; margin-top: 14px; ">
        <div style="display: inline-block; text-align: center; 
                width: calc(100% - 70px); margin: 0 35px 0 35px; border: 3px solid #148f91">

          <div style="display: inline-block; text-align: center; width: 100%-50px; margin: 25px 25px 35px 25px">
            <div class="sh_chalk_font" style="color: #636661; font-size: 18px;">
              Zauzeta sam... <br>
            </div>
          </div>

        </div>
      </div>


      <div style="display:block; width: 100%; text-align: right; margin-top: -3px; ">
        <svg xmlns="http://www.w3.org/2000/svg" id="prefix__noun_Monster_3288402" 
             width="84.305" height="91.091" viewBox="0 0 84.305 91.091" style="margin-right:35px">
            <defs>
                <style>
                    .prefix__cls-1{fill:#148f91}
                </style>
            </defs>
            <path id="prefix__Path_219" d="M50.136 79.97c6.728 6.241 18.278-5.288 22.839-8.639 3.869-2.837 8.078-6.648 12.719-8.425A22.581 22.581 0 0 1 86.556 66c1.021 3.3 6.5 1.895 5.469-1.424-1.259-4.036-2.712-8.478-8.237-6.691a18.047 18.047 0 0 0-2.235.91c-3.165 1.563-6.081 4.025-8.782 5.973-3.063 2.216-6.1 4.475-9.156 6.733-1.986 1.467-4.856 4.089-7.511 4.571-5.412 1-2.235-10.983-1.645-13.7.579-2.6 1.259-5.2 2.02-7.772l1.509-1.435 1.312 4.228 4.618-3.768L68.2 37.7c.465-.332.908-.674 1.373-.985 1.464-.974 7.318-5.342 9.292-4.143 1.588.974-.2 7.258-.374 8.4q-.613 4.336-1.248 8.693l-.545 3.79a3.091 3.091 0 0 0 3.211 3.361 2.133 2.133 0 0 0 2.258-1.938L83.152 48c.635-4.421 1.849-9.078 1.793-13.553-.034-2.312-.647-4.721-2.712-6.155-3.721-2.6-8.85-.739-13.513 2.152a18.9 18.9 0 0 0-.545-2.644l9.065-10.855c1.259-1.52.9-1.884-.806-.824l-10.584 6.63a20.086 20.086 0 0 0-12.174-8.457 21.1 21.1 0 0 0-14.965 1.97L32.743 5.676c-.964-1.7-1.464-1.542-1.112.364l2.485 13.617a18.685 18.685 0 0 0-4.947 8.4l-.522 1.97c-7.795-6.509-14.772-15.394-15.124-25-.125-3.436-5.8-3.447-5.673 0 .443 12.222 9.36 23.034 19.25 30.731l-2.281 8.511 2.156 5.385 2.28-2.162c-4.357 12.942-6.819 27.416-4.436 40.7h-8.857a2.677 2.677 0 1 0 0 5.353h12.3A2.737 2.737 0 0 0 31 90.161c-3.347-13.542-.59-28.743 4.028-42.114l1.191 3.822 3.29-3.126 1.316 4.229 3.313-3.147 1.327 4.25 3.279-3.115 1.316 4.218.511-.482q-.94 3.304-1.66 6.647c-1.135 5.213-3.449 14.281 1.225 18.627zm-5.083-46.632a8.436 8.436 0 0 1-6.49-10.277 9 9 0 0 1 10.892-6.113 8.436 8.436 0 0 1 6.49 10.277 9 9 0 0 1-10.892 6.113z" class="prefix__cls-1" data-name="Path 219" transform="translate(-7.848 -2.453)"/>
            <path id="prefix__Path_220" d="M43.58 19.694a4.079 4.079 0 1 0 2.95 4.96 4.077 4.077 0 0 0-2.95-4.96zM42.6 22.4a.918.918 0 1 1-1.78-.45.918.918 0 0 1 1.78.45z" class="prefix__cls-1" data-name="Path 220" transform="translate(-3.214 -1.118)"/>
        </svg>
      </div>


    {{elements.end_popup()}}
    <!-- END WAIT POPUP -->




    <!-- START ERROR POPUP -->
    {{elements.start_popup("error", "top: 127px; left: 0%; 
         width: 100%; text-align: center; background: white; scroll-y: auto;
         border-radius: 10px; border: 0px solid #000000; box-shadow: 0px 5px 5px #dddddd;")}}

      <div style="display:block; width: 100%; text-align: left; margin-top: 23px; ">
        <div style="display: inline-block; cursor: pointer; width: 23px; height: 23px; margin-left: 37px"
             onclick="popup_toggle_error()">
          <svg xmlns="http://www.w3.org/2000/svg" width="23" height="23" viewBox="0 0 23 23">
            <path id="prefix__Icon_material-close" d="M30.5 9.816L28.184 7.5 19 16.684 9.816 7.5 7.5 9.816 16.684 19 7.5 28.184 9.816 30.5 19 21.316l9.184 9.184 2.316-2.316L21.316 19z" data-name="Icon material-close" transform="translate(-7.5 -7.5)" style="fill:#148f91"/>
          </svg>
        </div>
      </div>

      {% set width=4 %}

      <div style="display:block; width: 100%; text-align: center; margin-top: 14px; ">
        <div style="display: inline-block; text-align: center; 
                width: calc(100% - 70px); margin: 0 35px 0 35px; border: 3px solid #148f91">

          <div style="display: inline-block; text-align: center; width: 100%-50px; margin: 25px 25px 35px 25px">
            <div class="sh_chalk_font" style="color: #636661; font-size: 18px;">
              Izvinjavam se, neka greška... <br><br>
              Mozda da probaš kao gost?
            </div>
          </div>

        </div>
      </div>


      <div style="display:block; width: 100%; text-align: right; margin-top: -3px; ">
        <svg xmlns="http://www.w3.org/2000/svg" id="prefix__noun_Monster_3288402" 
             width="84.305" height="91.091" viewBox="0 0 84.305 91.091" style="margin-right:35px">
            <defs>
                <style>
                    .prefix__cls-1{fill:#148f91}
                </style>
            </defs>
            <path id="prefix__Path_219" d="M50.136 79.97c6.728 6.241 18.278-5.288 22.839-8.639 3.869-2.837 8.078-6.648 12.719-8.425A22.581 22.581 0 0 1 86.556 66c1.021 3.3 6.5 1.895 5.469-1.424-1.259-4.036-2.712-8.478-8.237-6.691a18.047 18.047 0 0 0-2.235.91c-3.165 1.563-6.081 4.025-8.782 5.973-3.063 2.216-6.1 4.475-9.156 6.733-1.986 1.467-4.856 4.089-7.511 4.571-5.412 1-2.235-10.983-1.645-13.7.579-2.6 1.259-5.2 2.02-7.772l1.509-1.435 1.312 4.228 4.618-3.768L68.2 37.7c.465-.332.908-.674 1.373-.985 1.464-.974 7.318-5.342 9.292-4.143 1.588.974-.2 7.258-.374 8.4q-.613 4.336-1.248 8.693l-.545 3.79a3.091 3.091 0 0 0 3.211 3.361 2.133 2.133 0 0 0 2.258-1.938L83.152 48c.635-4.421 1.849-9.078 1.793-13.553-.034-2.312-.647-4.721-2.712-6.155-3.721-2.6-8.85-.739-13.513 2.152a18.9 18.9 0 0 0-.545-2.644l9.065-10.855c1.259-1.52.9-1.884-.806-.824l-10.584 6.63a20.086 20.086 0 0 0-12.174-8.457 21.1 21.1 0 0 0-14.965 1.97L32.743 5.676c-.964-1.7-1.464-1.542-1.112.364l2.485 13.617a18.685 18.685 0 0 0-4.947 8.4l-.522 1.97c-7.795-6.509-14.772-15.394-15.124-25-.125-3.436-5.8-3.447-5.673 0 .443 12.222 9.36 23.034 19.25 30.731l-2.281 8.511 2.156 5.385 2.28-2.162c-4.357 12.942-6.819 27.416-4.436 40.7h-8.857a2.677 2.677 0 1 0 0 5.353h12.3A2.737 2.737 0 0 0 31 90.161c-3.347-13.542-.59-28.743 4.028-42.114l1.191 3.822 3.29-3.126 1.316 4.229 3.313-3.147 1.327 4.25 3.279-3.115 1.316 4.218.511-.482q-.94 3.304-1.66 6.647c-1.135 5.213-3.449 14.281 1.225 18.627zm-5.083-46.632a8.436 8.436 0 0 1-6.49-10.277 9 9 0 0 1 10.892-6.113 8.436 8.436 0 0 1 6.49 10.277 9 9 0 0 1-10.892 6.113z" class="prefix__cls-1" data-name="Path 219" transform="translate(-7.848 -2.453)"/>
            <path id="prefix__Path_220" d="M43.58 19.694a4.079 4.079 0 1 0 2.95 4.96 4.077 4.077 0 0 0-2.95-4.96zM42.6 22.4a.918.918 0 1 1-1.78-.45.918.918 0 0 1 1.78.45z" class="prefix__cls-1" data-name="Path 220" transform="translate(-3.214 -1.118)"/>
        </svg>
      </div>


    {{elements.end_popup()}}
    <!-- END ERROR POPUP -->



    <script>
      function onSignIn(googleUser) {
          console.log('Google sign in');
          var profile = googleUser.getBasicProfile();
          var id_token = googleUser.getAuthResponse().id_token;
          console.log('ID: ' + profile.getId()); // Do not send to your backend! Use an ID token instead.
          console.log('Name: ' + profile.getName());
          console.log('Image URL: ' + profile.getImageUrl());
          console.log('Email: ' + profile.getEmail()); // This is null if the 'email' scope is not present.

          var xhr = new XMLHttpRequest();
          xhr.open('POST', '{{ template_params["google_link"] }}');
          xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
          xhr.onload = function() {
          console.log('Sign in response: ' + xhr.responseText);
          var r = xhr.responseText.split(':')
          if (r[0] == 'OK') {
              window.location.assign(r[1]);
          } else {
              document.getElementById('gauth_status').innerText = "Login error: " + r[1];
              popup_toggle_wait("hidden");
              popup_toggle_error("visible");
          }
          };
          xhr.send('id_token=' + id_token);
      }
    </script>


    <script src="https://apis.google.com/js/api:client.js"></script>
    <script>
      var googleUser = {};
      var startGoogleAuth = function() {
          gapi.load('auth2', function(){
          // Retrieve the singleton for the GoogleAuth library and set up the client.
          // B: When having auth problems on tablet, do we need to set more parameters here:
          // https://developers.google.com/identity/sign-in/web/reference#gapiauth2clientconfig
          auth2 = gapi.auth2.init({
              client_id: '{{ template_params['google_signin_client_id'] }}',
              cookiepolicy: 'single_host_origin',
              // Request scopes in addition to 'profile' and 'email'
              //scope: 'additional_scope'
          });
          attachSignin(document.getElementById('button_user_google'));
          });
      };

      function attachSignin(element) {
          console.log("Element id: ", element.id);
          auth2.attachClickHandler(element, {}, onSignIn,
              function(error) {
                var xhr = new XMLHttpRequest();
                var url = '/main?op=feedback'
                xhr.open('POST', url);
                xhr.onreadystatechange = function() {
                    console.log("Received");
                    console.log(xhr);
                    if (xhr.readyState>3 && xhr.status==200) { console.log("Success: ", xhr.responseText); }
                };
                var report = {};
                report['type'] = 'GOOGLE_ERROR';
                report['comment'] = JSON.stringify(error, undefined, 2);
                xhr.setRequestHeader('Content-Type', 'application/json');
                console.log("Sending report to " + url + ": " + JSON.stringify(report));
                xhr.send(JSON.stringify(report));
                alert(JSON.stringify(error, undefined, 2));
                popup_toggle_wait("hidden");
              });
      }
    </script>



    <div style="display:table; margin:0 auto">
      <div align="center" style="display:content; border:0px; padding:0px; margin:0px">
        <div id="button_user_google" class="sh-std-button" 
            onclick="popup_toggle_wait('visible');"
            style="display: inline-block;
                    background: #f9f9f9;
                    width: 240px;
                    height: 40px;
                    margin: 83px 10px 10px 10px;">

          <div id="text_user_google"> 
            <div class="sh_lato_font"
                style="display: inline-block;
                    cursor: pointer;
                    vertical-align: middle;
                    margin: 10px 0px 10px 23px;
                    font-size: 18px;
                    color: #6ab288"> 
                      ULOGUJ SE PREKO 
            </div>
            <div style="display: inline-block; 
                        margin-right: 22px; 
                        margin-left: 6px; 
                        margin-top: 0px; 
                        height: 22px; 
                        vertical-align: middle">
              <img src="item?url=images/google.png" alt="G" height="22px" width="22px">
            </div>
          </div>
        </div>
        <div id='gauth_status'></div>
        <script>startGoogleAuth();</script>
      <div>

      <div align="center" style="display:content; border:0px; padding:0px; margin:0px">
          <a id="text_user_guest", class="sh_lato_font", style="display: inline-block;
                cursor: pointer;
                margin-top: 15px;
                font-size: 10px;
                color: #b0b6b6"
                href=" {{ template_params['guest_link'] }} "> ULOGUJ SE KAO GOST </a>
      </div>
    </div>

  </body>
</html>
